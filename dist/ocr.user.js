// ==UserScript==
// @name         OCRËÑöÊú¨
// @namespace    http://tampermonkey.net/
// @version      1.0
// @description  ‰ΩøÁî®ÊåáÂÆöaiËØÜÂà´ÂõæÁâá
// @author       yoki
// @match        *://**/*
// @grant        unsafeWindow
// @grant        GM_getValue
// @grant        GM_setValue
// @grant        GM_setClipboard
// @grant        GM_xmlhttpRequest
// @grant        GM_registerMenuCommand
// @run-at       document-end
// ==/UserScript==
(()=>{var e={172(e){e.exports=function(e,t){this.v=e,this.k=t},e.exports.__esModule=!0,e.exports.default=e.exports},373(e){e.exports=function(e){var t=Object(e),r=[];for(var n in t)r.unshift(n);return function e(){for(;r.length;)if((n=r.pop())in t)return e.value=n,e.done=!1,e;return e.done=!0,e}},e.exports.__esModule=!0,e.exports.default=e.exports},546(e){function t(r,n,o,s){var u=Object.defineProperty;try{u({},"",{})}catch(r){u=0}e.exports=t=function(e,r,n,o){function s(r,n){t(e,r,function(e){return this._invoke(r,n,e)})}r?u?u(e,r,{value:n,enumerable:!o,configurable:!o,writable:!o}):e[r]=n:(s("next",0),s("throw",1),s("return",2))},e.exports.__esModule=!0,e.exports.default=e.exports,t(r,n,o,s)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},579(e,t,r){var n=r(738).default;e.exports=function(e){if(null!=e){var t=e["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],r=0;if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length))return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}}throw new TypeError(n(e)+" is not iterable")},e.exports.__esModule=!0,e.exports.default=e.exports},633(e,t,r){var n=r(172),o=r(993),s=r(869),u=r(887),i=r(791),a=r(373),c=r(579);function p(){"use strict";var t=o(),r=t.m(p),l=(Object.getPrototypeOf?Object.getPrototypeOf(r):r.__proto__).constructor;function f(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===l||"GeneratorFunction"===(t.displayName||t.name))}var d={throw:1,return:2,break:3,continue:3};function x(e){var t,r;return function(n){t||(t={stop:function(){return r(n.a,2)},catch:function(){return n.v},abrupt:function(e,t){return r(n.a,d[e],t)},delegateYield:function(e,o,s){return t.resultName=o,r(n.d,c(e),s)},finish:function(e){return r(n.f,e)}},r=function(e,r,o){n.p=t.prev,n.n=t.next;try{return e(r,o)}finally{t.next=n.n}}),t.resultName&&(t[t.resultName]=n.v,t.resultName=void 0),t.sent=n.v,t.next=n.n;try{return e.call(this,t)}finally{n.p=t.prev,n.n=t.next}}}return(e.exports=p=function(){return{wrap:function(e,r,n,o){return t.w(x(e),r,n,o&&o.reverse())},isGeneratorFunction:f,mark:t.m,awrap:function(e,t){return new n(e,t)},AsyncIterator:i,async:function(e,t,r,n,o){return(f(t)?u:s)(x(e),t,r,n,o)},keys:a,values:c}},e.exports.__esModule=!0,e.exports.default=e.exports)()}e.exports=p,e.exports.__esModule=!0,e.exports.default=e.exports},738(e){function t(r){return e.exports=t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,t(r)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},756(e,t,r){var n=r(633)();e.exports=n;try{regeneratorRuntime=n}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=n:Function("r","regeneratorRuntime = r")(n)}},791(e,t,r){var n=r(172),o=r(546);e.exports=function e(t,r){function s(e,o,u,i){try{var a=t[e](o),c=a.value;return c instanceof n?r.resolve(c.v).then(function(e){s("next",e,u,i)},function(e){s("throw",e,u,i)}):r.resolve(c).then(function(e){a.value=e,u(a)},function(e){return s("throw",e,u,i)})}catch(e){i(e)}}var u;this.next||(o(e.prototype),o(e.prototype,"function"==typeof Symbol&&Symbol.asyncIterator||"@asyncIterator",function(){return this})),o(this,"_invoke",function(e,t,n){function o(){return new r(function(t,r){s(e,n,t,r)})}return u=u?u.then(o,o):o()},!0)},e.exports.__esModule=!0,e.exports.default=e.exports},869(e,t,r){var n=r(887);e.exports=function(e,t,r,o,s){var u=n(e,t,r,o,s);return u.next().then(function(e){return e.done?e.value:u.next()})},e.exports.__esModule=!0,e.exports.default=e.exports},887(e,t,r){var n=r(993),o=r(791);e.exports=function(e,t,r,s,u){return new o(n().w(e,t,r,s),u||Promise)},e.exports.__esModule=!0,e.exports.default=e.exports},993(e,t,r){var n=r(546);function o(){var t,r,s="function"==typeof Symbol?Symbol:{},u=s.iterator||"@@iterator",i=s.toStringTag||"@@toStringTag";function a(e,o,s,u){var i=o&&o.prototype instanceof p?o:p,a=Object.create(i.prototype);return n(a,"_invoke",function(e,n,o){var s,u,i,a=0,p=o||[],l=!1,f={p:0,n:0,v:t,a:d,f:d.bind(t,4),d:function(e,r){return s=e,u=0,i=t,f.n=r,c}};function d(e,n){for(u=e,i=n,r=0;!l&&a&&!o&&r<p.length;r++){var o,s=p[r],d=f.p,x=s[2];e>3?(o=x===n)&&(i=s[(u=s[4])?5:(u=3,3)],s[4]=s[5]=t):s[0]<=d&&((o=e<2&&d<s[1])?(u=0,f.v=n,f.n=s[1]):d<x&&(o=e<3||s[0]>n||n>x)&&(s[4]=e,s[5]=n,f.n=x,u=0))}if(o||e>1)return c;throw l=!0,n}return function(o,p,x){if(a>1)throw TypeError("Generator is already running");for(l&&1===p&&d(p,x),u=p,i=x;(r=u<2?t:i)||!l;){s||(u?u<3?(u>1&&(f.n=-1),d(u,i)):f.n=i:f.v=i);try{if(a=2,s){if(u||(o="next"),r=s[o]){if(!(r=r.call(s,i)))throw TypeError("iterator result is not an object");if(!r.done)return r;i=r.value,u<2&&(u=0)}else 1===u&&(r=s.return)&&r.call(s),u<2&&(i=TypeError("The iterator does not provide a '"+o+"' method"),u=1);s=t}else if((r=(l=f.n<0)?i:e.call(n,f))!==c)break}catch(e){s=t,u=1,i=e}finally{a=1}}return{value:r,done:l}}}(e,s,u),!0),a}var c={};function p(){}function l(){}function f(){}r=Object.getPrototypeOf;var d=[][u]?r(r([][u]())):(n(r={},u,function(){return this}),r),x=f.prototype=p.prototype=Object.create(d);function y(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,n(e,i,"GeneratorFunction")),e.prototype=Object.create(x),e}return l.prototype=f,n(x,"constructor",f),n(f,"constructor",l),l.displayName="GeneratorFunction",n(f,i,"GeneratorFunction"),n(x),n(x,i,"Generator"),n(x,u,function(){return this}),n(x,"toString",function(){return"[object Generator]"}),(e.exports=o=function(){return{w:a,m:y}},e.exports.__esModule=!0,e.exports.default=e.exports)()}e.exports=o,e.exports.__esModule=!0,e.exports.default=e.exports}},t={};function r(n){var o=t[n];if(void 0!==o)return o.exports;var s=t[n]={exports:{}};return e[n](s,s.exports,r),s.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";function e(e,t,r,n,o,s,u){try{var i=e[s](u),a=i.value}catch(e){return void r(e)}i.done?t(a):Promise.resolve(a).then(n,o)}function t(t){return function(){var r=this,n=arguments;return new Promise(function(o,s){var u=t.apply(r,n);function i(t){e(u,o,s,i,a,"next",t)}function a(t){e(u,o,s,i,a,"throw",t)}i(void 0)})}}var n=r(756),o=r.n(n);!function(){var e,r="https://api.deepseek.com/v1/chat/completions",n="deepseek-v3",s=!1,u=[];function i(){return GM_getValue("deepseek_api_token","")}function a(e){GM_setValue("deepseek_api_token",e)}function c(){var e=prompt("ËØ∑ËæìÂÖ•DeepSeek API Token",i());return null!==e?(a(e),e):null}function p(e){return l.apply(this,arguments)}function l(){return(l=t(o().mark(function e(t){return o().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e,r){var n=new Image;n.crossOrigin="anonymous",n.onload=function(){try{var t=document.createElement("canvas");t.width=n.width,t.height=n.height,t.getContext("2d").drawImage(n,0,0);var o=t.toDataURL("image/jpeg");e(o)}catch(e){r(new Error("ËΩ¨Êç¢ÂõæÁâáÂ§±Ë¥•: "+e.message))}},n.onerror=function(){r(new Error("Âä†ËΩΩÂõæÁâáÂ§±Ë¥•"))},n.src=t,(n.complete||void 0===n.complete)&&(n.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==",n.src=t)}));case 1:case"end":return e.stop()}},e)}))).apply(this,arguments)}function f(e){return d.apply(this,arguments)}function d(){return(d=t(o().mark(function e(t){var r,n,u,i;return o().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(s){e.next=1;break}return e.abrupt("return");case 1:return t.preventDefault(),t.stopPropagation(),r=t.target,e.prev=2,h("Â§ÑÁêÜ‰∏≠...","info"),n=r.src,e.next=3,p(n);case 3:u=e.sent,b(),x(u),e.next=5;break;case 4:e.prev=4,i=e.catch(2),console.error("Â§ÑÁêÜÂõæÁâáÂá∫Èîô:",i),h("ÈîôËØØ: ".concat(i.message),"error"),b();case 5:case"end":return e.stop()}},e,null,[[2,4]])}))).apply(this,arguments)}function x(e){return y.apply(this,arguments)}function y(){return(y=t(o().mark(function e(t){var r,n,s;return o().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,r=i()){e.next=1;break}if(r=c()){e.next=1;break}return h("ÈúÄË¶ÅAPI TokenÊâçËÉΩÁªßÁª≠","error"),e.abrupt("return");case 1:return h("Ê≠£Âú®ËØÜÂà´ÂõæÁâáÊñáÂ≠ó...","info"),e.next=2,v(t,r);case 2:n=e.sent,GM_setClipboard(n),h("ÊñáÊú¨Â∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥ÊùøÔºÅ","success"),e.next=4;break;case 3:e.prev=3,s=e.catch(0),console.error("OCRËØÜÂà´Â§±Ë¥•:",s),h("ÈîôËØØ: ".concat(s.message),"error"),(s.message.includes("auth")||s.message.includes("API key")||s.message.includes("token")||s.message.includes("ËÆ§ËØÅ"))&&setTimeout(function(){confirm("API TokenÂèØËÉΩÊó†ÊïàÊàñÂ∑≤ËøáÊúüÔºåÊòØÂê¶ÈáçÊñ∞ËÆæÁΩÆÔºü")&&c()},1e3);case 4:case"end":return e.stop()}},e,null,[[0,3]])}))).apply(this,arguments)}function v(e,t){return m.apply(this,arguments)}function m(){return(m=t(o().mark(function e(t,s){var u;return o().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("ÂèëÈÄÅOCRËØ∑Ê±Ç..."),t.startsWith("data:")||(t="data:image/jpeg;base64,".concat(t)),u={model:n,messages:[{role:"user",content:[{type:"text",text:"ËØÜÂà´ÂõæÁâá‰∏≠ÁöÑÊñáÂ≠óÔºåÁõ¥Êé•ËøîÂõûÂÜÖÂÆπÔºå‰∏çË¶ÅÊúâÈ¢ùÂ§ñËß£Èáä"},{type:"image_url",image_url:{url:t}}]}],temperature:.1},e.abrupt("return",new Promise(function(e,t){GM_xmlhttpRequest({method:"POST",url:r,headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(s)},data:JSON.stringify(u),onload:function(r){console.log("APIÂìçÂ∫îÁä∂ÊÄÅ:",r.status);try{if(200!==r.status)return console.error("APIÂìçÂ∫îÁä∂ÊÄÅÁ†ÅÂºÇÂ∏∏:",r.status),console.error("ÂìçÂ∫îÂÜÖÂÆπ:",r.responseText),void t(new Error("APIËøîÂõûÂºÇÂ∏∏Áä∂ÊÄÅ: ".concat(r.status)));if(!r.responseText)return void t(new Error("APIËøîÂõûÁ©∫ÂìçÂ∫î"));var n;try{n=JSON.parse(r.responseText)}catch(e){return console.error("JSONËß£ÊûêÈîôËØØ:",e),console.error("ÂéüÂßãÂìçÂ∫î:",r.responseText.substring(0,500)),void(r.responseText.startsWith("Failed to")?t(new Error("APIÈîôËØØ: ".concat(r.responseText.substring(0,100),"..."))):t(new Error("APIËøîÂõûÁöÑ‰∏çÊòØÊúâÊïàÁöÑJSONÊ†ºÂºè")))}if(n.error)return"invalid_api_key"===n.error.code&&a(""),void t(new Error(n.error.message||"APIÊä•ÂëäÈîôËØØ"));if(!n.choices||!n.choices[0]||!n.choices[0].message)return void t(new Error("APIËøîÂõûÊï∞ÊçÆÁªìÊûÑÂºÇÂ∏∏"));var o=n.choices[0].message.content;e(o)}catch(e){t(new Error("Â§ÑÁêÜAPIÂìçÂ∫îÂ§±Ë¥•: ".concat(e.message)))}},onerror:function(e){console.error("ËØ∑Ê±ÇÈîôËØØ:",e),t(new Error("ÁΩëÁªúËØ∑Ê±ÇÂ§±Ë¥•: "+(e.statusText||"ËøûÊé•ÈîôËØØ")))},ontimeout:function(){t(new Error("ËØ∑Ê±ÇË∂ÖÊó∂"))}})}));case 1:case"end":return e.stop()}},e)}))).apply(this,arguments)}function h(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",r=document.getElementById("deepseek-ocr-status");switch(r||((r=document.createElement("div")).id="deepseek-ocr-status",r.style.cssText="\n            position: fixed;\n            bottom: 20px;\n            right: 20px;\n            padding: 10px 15px;\n            border-radius: 4px;\n            z-index: 9999;\n            font-size: 14px;\n            transition: opacity 0.3s;\n            box-shadow: 0 2px 4px rgba(0,0,0,0.2);\n        ",document.body.appendChild(r)),t){case"error":r.style.backgroundColor="#f44336",r.style.color="white";break;case"success":r.style.backgroundColor="#4caf50",r.style.color="white";break;default:r.style.backgroundColor="#2196f3",r.style.color="white"}r.textContent=e,r.style.opacity="1",setTimeout(function(){r.style.opacity="0",setTimeout(function(){r.parentNode&&r.parentNode.removeChild(r)},300)},3e3)}function g(){if(!s){s=!0;var e=document.getElementById("deepseek-ocr-button");e&&(e.style.backgroundColor="#ff5722",e.textContent="‚ùå ÂèñÊ∂à"),h("ËØ∑ÁÇπÂáªË¶ÅËØÜÂà´ÁöÑÂõæÁâá","info");var t=document.querySelectorAll("img");u=[],t.forEach(function(e){if(e.naturalWidth>50&&e.naturalHeight>50){var t={outline:e.style.outline,cursor:e.style.cursor,filter:e.style.filter};e.style.outline="3px solid #ff5722",e.style.cursor="pointer",e.style.filter="brightness(1.1)",e.addEventListener("click",f),u.push({element:e,originalStyles:t})}}),0===u.length&&(h("Êú™ÊâæÂà∞ÂèØËØÜÂà´ÁöÑÂõæÁâá","error"),b())}}function b(){if(s){s=!1;var e=document.getElementById("deepseek-ocr-button");e&&(e.style.backgroundColor="#4285f4",e.textContent="üì∑ OCR"),u.forEach(function(e){var t=e.element,r=e.originalStyles;t.style.outline=r.outline,t.style.cursor=r.cursor,t.style.filter=r.filter,t.removeEventListener("click",f)}),u=[]}}(e=document.createElement("button")).id="deepseek-ocr-button",e.textContent="üì∑ OCR",e.style.cssText="\n        position: fixed;\n        right: 20px;\n        bottom: 70px;\n        padding: 10px 15px;\n        background-color: #4285f4;\n        color: white;\n        border: none;\n        border-radius: 4px;\n        cursor: pointer;\n        z-index: 9999;\n        box-shadow: 0 2px 5px rgba(0,0,0,0.3);\n        font-size: 14px;\n        display: flex;\n        align-items: center;\n        transition: 0.3s;\n    ",e.onmouseover=function(){this.style.backgroundColor="#3367d6"},e.onmouseout=function(){s||(this.style.backgroundColor="#4285f4")},e.onclick=function(){s?b():g()},document.body.appendChild(e),GM_registerMenuCommand("ËÆæÁΩÆAPI Token",c),GM_registerMenuCommand("ÈÄâÊã©ÁΩëÈ°µÂõæÁâáËØÜÂà´",g)}()})()})();