// ==UserScript==
// @name         CICC äº‘åˆ†æå‘Šè­¦é€šçŸ¥
// @namespace    http://tampermonkey.net/
// @version      1.0
// @description  æ¯éš”ä¸€ä¸ªå°æ—¶å°†ç›‘æ§æ•°æ®å‘é€åˆ°é£ä¹¦æœºå™¨äºº
// @author       yoki
// @match        https://console.cloud.tencent.com/monitor/rum/analysis*
// @grant        GM_xmlhttpRequest
// @grant        GM_notification
// @run-at       document-end
// ==/UserScript==
(()=>{"use strict";function o(o,t){(null==t||t>o.length)&&(t=o.length);for(var e=0,n=Array(t);e<t;e++)n[e]=o[e];return n}function t(t,e){return function(o){if(Array.isArray(o))return o}(t)||function(o,t){var e=null==o?null:"undefined"!=typeof Symbol&&o[Symbol.iterator]||o["@@iterator"];if(null!=e){var n,r,i,a,c=[],l=!0,C=!1;try{if(i=(e=e.call(o)).next,0===t){if(Object(e)!==e)return;l=!1}else for(;!(l=(n=i.call(e)).done)&&(c.push(n.value),c.length!==t);l=!0);}catch(o){C=!0,r=o}finally{try{if(!l&&null!=e.return&&(a=e.return(),Object(a)!==a))return}finally{if(C)throw r}}return c}}(t,e)||function(t,e){if(t){if("string"==typeof t)return o(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?o(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}
// ==UserScript==
// @name         CICC äº‘åˆ†æå‘Šè­¦é€šçŸ¥
// @namespace    http://tampermonkey.net/
// @version      1.0.0
// @description  æ¯éš”ä¸€ä¸ªå°æ—¶å°†ç›‘æ§æ•°æ®å‘é€åˆ°é£ä¹¦æœºå™¨äºº
// @author       You
// @match        https://console.cloud.tencent.com/monitor/rum/analysis*
// @grant        GM_xmlhttpRequest
// @grant        GM_notification
// ==/UserScript==
!function(){console.log("=========================================="),console.log("[CICC Monitor] ğŸš€ è„šæœ¬å¼€å§‹æ‰§è¡Œ"),console.log("[CICC Monitor] ğŸ“ å½“å‰ URL:",window.location.href),console.log("[CICC Monitor] ğŸ“„ Document readyState:",document.readyState),console.log("[CICC Monitor] â° æ—¶é—´:",(new Date).toLocaleString("zh-CN")),console.log("==========================================");function o(o){!function(o){for(var e=(new Date).toLocaleString("zh-CN",{timeZone:"Asia/Shanghai",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}),n=["ğŸ“Š **CICC äº‘åˆ†æç›‘æ§æŠ¥å‘Š**","â° æ—¶é—´: ".concat(e),"","---"],r=0,i=Object.entries(o);r<i.length;r++){var a=t(i[r],2),c=a[0],l=a[1];n.push("**".concat(c,"**: ").concat(l.value)),l.compare&&n.push("   â”” ".concat(l.compare))}n.push("","---","_æ•°æ®æ¯å°æ—¶è‡ªåŠ¨é‡‡é›†_"),n.join("\n")}(o);var r={msg_type:"interactive",card:{config:{wide_screen_mode:!0},header:{title:{tag:"plain_text",content:"ğŸ“Š CICC äº‘åˆ†æç›‘æ§æŠ¥å‘Š"},template:"blue"},elements:[{tag:"div",text:{tag:"lark_md",content:e(o)}},{tag:"hr"},{tag:"note",elements:[{tag:"plain_text",content:"æ•°æ®é‡‡é›†æ—¶é—´: ".concat((new Date).toLocaleString("zh-CN",{timeZone:"Asia/Shanghai"}))}]}]}};GM_xmlhttpRequest({method:"POST",url:"https://open.feishu.cn/open-apis/bot/v2/hook/f38e034a-78d0-4925-9079-7c44a3a9800b",headers:{"Content-Type":"application/json"},data:JSON.stringify(r),onload:function(o){console.log("[CICC Monitor] é£ä¹¦é€šçŸ¥å‘é€æˆåŠŸ:",o.responseText),n("å‘é€æˆåŠŸ","ç›‘æ§æ•°æ®å·²å‘é€åˆ°é£ä¹¦")},onerror:function(o){console.error("[CICC Monitor] é£ä¹¦é€šçŸ¥å‘é€å¤±è´¥:",o),n("å‘é€å¤±è´¥","ç›‘æ§æ•°æ®å‘é€åˆ°é£ä¹¦å¤±è´¥")}})}function e(o){for(var e=[],n=0,r=Object.entries(o);n<r.length;n++){var i=t(r[n],2),a=i[0],c=i[1],l=(parseInt(c.value)||0)>0?"ğŸ”´":"ğŸŸ¢";if(e.push("".concat(l," **").concat(a,"**: ").concat(c.value)),c.compare){var C="â–";c.compare.includes("â†‘")||c.compare.includes("up")?C="ğŸ“ˆ":(c.compare.includes("â†“")||c.compare.includes("down"))&&(C="ğŸ“‰"),e.push("    ".concat(C," ").concat(c.compare))}}return e.join("\n")}function n(o,t){GM_notification({title:"[CICC Monitor] ".concat(o),text:t,timeout:3e3})}function r(){console.log("[CICC Monitor] å¼€å§‹é‡‡é›†ç›‘æ§æ•°æ®...");var t=function(){console.log("[CICC Monitor] ğŸ“Š å¼€å§‹æå–æ•°æ®...");var o={},t=document.querySelectorAll(".info-header.card .info-item");if(console.log("[CICC Monitor] ğŸ” æ‰¾åˆ° .info-header.card .info-item å…ƒç´ æ•°é‡:",t.length),0===t.length){console.log("[CICC Monitor] âš ï¸ æœªæ‰¾åˆ°å…ƒç´ ï¼Œå°è¯•å…¶ä»–é€‰æ‹©å™¨...");var e=document.querySelectorAll(".info-item");console.log("[CICC Monitor] ğŸ” æ‰¾åˆ° .info-item å…ƒç´ æ•°é‡:",e.length);var n=document.querySelectorAll(".info-header");console.log("[CICC Monitor] ğŸ” æ‰¾åˆ° .info-header å…ƒç´ æ•°é‡:",n.length);var r=document.querySelectorAll(".data");console.log("[CICC Monitor] ğŸ” æ‰¾åˆ° .data å…ƒç´ æ•°é‡:",r.length)}return t.forEach(function(t){var e=t.querySelector(".title"),n=t.querySelector(".data"),r=t.querySelector(".compare-span");if(e&&n){var i=e.textContent.trim(),a=n.textContent.trim(),c=r?r.textContent.trim():"";o[i]={value:a,compare:c}}}),o}();0!==Object.keys(t).length?(console.log("[CICC Monitor] é‡‡é›†åˆ°çš„æ•°æ®:",t),o(t)):console.warn("[CICC Monitor] æœªæ‰¾åˆ°ç›‘æ§æ•°æ®ï¼Œå¯èƒ½é¡µé¢ç»“æ„å·²å˜åŒ–")}function i(){console.log("[CICC Monitor] ğŸ“Œ init() å‡½æ•°è¢«è°ƒç”¨"),console.log("[CICC Monitor] ğŸ”„ è„šæœ¬å·²åŠ è½½ï¼Œå°†æ¯éš” 1 å°æ—¶å‘é€ç›‘æ§æ•°æ®åˆ°é£ä¹¦"),console.log("[CICC Monitor] â³ ç­‰å¾… 5 ç§’åå¼€å§‹é¦–æ¬¡é‡‡é›†..."),setTimeout(function(){console.log("[CICC Monitor] â° 5 ç§’ç­‰å¾…ç»“æŸï¼Œå¼€å§‹é¦–æ¬¡é‡‡é›†"),r(),setInterval(r,36e5),console.log("[CICC Monitor] âœ… å®šæ—¶ä»»åŠ¡å·²å¯åŠ¨ï¼Œé—´éš”: 1 å°æ—¶")},5e3)}console.log("[CICC Monitor] ğŸ” æ£€æŸ¥ document.readyState:",document.readyState),"loading"===document.readyState?(console.log("[CICC Monitor] ğŸ“„ é¡µé¢ä»åœ¨åŠ è½½ï¼Œæ·»åŠ  DOMContentLoaded ç›‘å¬å™¨"),document.addEventListener("DOMContentLoaded",function(){console.log("[CICC Monitor] ğŸ“„ DOMContentLoaded äº‹ä»¶è§¦å‘"),i()})):(console.log("[CICC Monitor] ğŸ“„ é¡µé¢å·²åŠ è½½å®Œæˆï¼Œç›´æ¥è°ƒç”¨ init()"),i())}()})();